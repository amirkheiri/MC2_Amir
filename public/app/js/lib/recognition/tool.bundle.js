!function e(t,n,o){function r(s,l){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!l&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n||e)},c,c.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.ALPHANUMERIC))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":14}],2:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=e("./enums/BracketTypes"),s=function(e){function t(e,n,o,s,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,s,l,r.BRACKET));a.bracketType=i.CLOSE;var u=["lbracket","(",")","rbracket"];return u.indexOf(l)<u.length/2&&(a.minX-=o,a.maxX-=o,a.x-=o,a.bracketType=i.OPEN),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=s},{"./Symbol":9,"./enums/BracketTypes":12,"./enums/SymbolTypes":14}],3:[function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();e("./Symbol"),e("./enums/SymbolTypes");var r=e("./enums/RegionTypes"),i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.ROOT;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.region_type=t,this.region_name=t,this.wall={left:0,bottom:1/0,right:1/0,top:0},this.symbols=[]}return o(e,[{key:"addSymbol",value:function(e){this.symbols.push(e)}},{key:"setWall",value:function(e,t,n,o){if(!e.left)return e.length&&3==e.length?(this.wall.left=e[0][0],this.wall.bottom=e[0][1],this.wall.right=e[1][0],void(this.wall.top=e[1][1])):void(this.wall={left:e,bottom:o,right:n,top:t});this.wall=e}},{key:"hasElement",value:function(){return this.symbols.length>0}},{key:"apply",value:function(e,t,n){n||(n=function(){return!0}),t||(t=function(){return!0});for(var o=0;o<this.symbols.length;o++)if("lim"===this.symbols[o].value){for(var r=!1,i=0;i<this.symbols[o].subSymbols.length;i++)n(this.symbols[o].subSymbols[i])?(e(this.symbols[o].subSymbols[i]),this.symbols[o].subSymbols[i].apply(e,function(e){return!0},n),r=!0):this.symbols[o].subSymbols[i].apply(e,t,n);r?this.symbols[o].apply(e,function(e){return!0},n):this.symbols[o].apply(e,t,n)}else n(this.symbols[o])?(e(this.symbols[o]),this.symbols[o].apply(e,function(e){return!0},n)):this.symbols[o].apply(e,t,n)}}]),e}();t.exports=i},{"./Symbol":9,"./enums/RegionTypes":13,"./enums/SymbolTypes":14}],4:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.FRACTION))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":14}],5:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.LIMIT))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":14}],6:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.OPERATOR))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":14}],7:[function(e,t,n){"use strict";var o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var s,l=e[Symbol.iterator]();!(o=(s=l.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=e("./enums/SymbolTypes"),s=e("./SymbolFactory"),l=e("./enums/BracketTypes"),a=e("./Expression"),u=(e("./Symbol"),e("./enums/RegionTypes")),c=e("./constant"),f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"hor",value:function(t,n){if(t[n].type===i.FRACTION||t[n].type===i.BRAKET&&t[n].bracketType==l.OPEN||t[n].type===i.OPERATOR){var o=t[n].getWallCopy();o.left=t[n].maxX;var r=e.start(t,o);return-1==r?-1:e.overlap(r,t[n].wall,t)}for(var s=0;s<t.length;){if(e.isInRegion(t[n].wall,t[s])&&!t[s].marked&&t[n].maxX<=t[s].minX&&t[n].minY+.4*t[n].height<=t[s].y&&t[s].y<t[n].maxY-1*t[n].height/5)return e.overlap(s,t[n].wall,t);s++}return-1}},{key:"overlap",value:function(e,t,n){var o,r=e,s=t.top,l=t.bottom,a=!1,u=n.length;o=(n[e].type,i.FRACTION,n[e].width);for(var c=-1;r>0&&!a;)n[r-1].maxX<n[e].minX?a=!0:r-=1;for(;r<u&&n[r].minX<n[e].maxX;)!n[r].marked&&n[r].type===i.Fraction&&n[r].y>s&&n[r].y<=l&&n[r].minX<=n[e].x&&n[r].width>o?(o=n[r].width,c=r):r++;return-1==c?e:c}},{key:"isInRegion",value:function(e,t){return e.left<=t.x&&t.x<e.right&&e.top<=t.y&&t.y<=e.bottom}}],[{key:"getSymbolType",value:function(e){return-1!=c.BRACKET.indexOf(e)?i.BRACKET:-1!=c.LINE.indexOf(e)?i.FRACTION:-1!=c.Root.indexOf(e)?i.ROOT:-1!=c.LIMIT.indexOf(e)?i.LIMIT:-1!=c.OPERATOR.indexOf(e)?i.OPERATOR:i.ALPHANUMERIC}},{key:"start",value:function(t,n){for(var o=-1,r=-1,s=0,l=-1,a=t.length;-1==o&&s<a;)!t[s].marked&&e.isInRegion(n,t[s])?o=s:s+=1;if(-1==o||r==o)return o;for(;s<a&&-1==r;)!t[s].marked&&t[s].type===i.LIMIT&&e.isInRegion(n,t[s])?r=s:s+=1;if(-1==r||r==o)return e.overlap(o,n,t);for(var u=t[r].maxY,c=t[r].minY;s>o;)t[s-=1].y<u&&t[s].y>=c&&(l=s);return l<r&&-1!=l?e.overlap(o,n,t):e.overlap(r,n,t)}},{key:"parse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t){t=[];var n=svgCanvas.getSelectedElems().slice(0);0==n.__proto__.length&&(n=document.querySelectorAll('[id^="svg_eqn_"]'));for(var r=0;r<n.length;r++){var l=s.make(n[r]);l&&t.push(l)}}t.sort(function(e,t){var n=e.minX-t.minX;return 0==n?e.minY-t.minY:n});var c,f,y,p,m,h=new a,b=[],T=[],g=h.wall,E=e.start(t,g);for(-1!=E&&(t[E].setWall(g),T.push([E,h]),t[E].marked=!0);0!=T.length;)for(;0!=T.length;){var O=T.shift(),S=o(O,2);for(c=S[0],y=S[1],(p=t[c]).marked=!0,y.symbols.push(p),b.push([c,p]),g=t[c].wall,f=e.hor(t,c);-1!=f;){var v=t[c].wall;t[f].setWall(v),p=t[f];y.symbols.length;y.symbols.push(p),b.push([f,p]),t[c].wall.right=t[f].minX,t[f].type!==i.LIMIT||t[c].type!==i.BRACKET&&t[c].type!==i.FRACTION||(t[f].wall.left=t[c].maxX),t[c=f].marked=!0,f=e.hor(t,c)}for(b.push("EOBL");0!=b.length;){"EOBL"===b[b.length-1]&&b.pop();var w=b.pop(),R=o(w,2);c=R[0];var x=(p=R[1]).wall.top,_=p.wall.bottom,A=y.symbols.indexOf(p),C=A==y.symbols.length-1?p.wall.right:y.symbols[A+1].minX,B=p.minX;p.type===SYMBOL_TYPES.LIMIT&&(0==A?B=g.left:y.symbols[A-1].type===SYMBOL_TYPES.BRACKET?B=y.symbols[A-1].maxX:y.symbols[A-1].type===SYMBOL_TYPES.FRACTION&&(B=y.symbols[A-1].maxX));for(var d=p.minX,P=p.maxX,k=p.minY,L=p.maxY,I=k+.4*(L-k),X=L-.4*(L-k),N=(u.ABOVE,u.BELOW,u.SUPER,u.SUBSC,u.TLEFT,u.BLEFT,u.CONTAINS,[u.ABOVE,u.BELOW,u.SUPER,u.SUBSC,u.TLEFT,u.BLEFT,u.CONTAINS]),j=0;j<N.length;j++)p.region[N[j][2]]&&(p.region[N[j][2]].setWall(N[j]),-1!=(f=e.start(t,p.region[N[j][2]].wall))&&(t[f].marked=!0,t[f].setWall(p.region[N[j][2]].wall),m=p.region[N[j][2]],T.push([f,m])))}}return h}},{key:"getTex",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.parse(),n="";if(t.symbols){t.region_name==u.ROOT&&(n+="$$");for(var o=0;o<t.symbols.length;o++){n+=e.getTex(t.symbols[o])}return n.indexOf("lim")>=0&&(n=n.replace("li "," ")),t.region_name==u.ROOT&&(n=(n+="$$").replace(/arcsin|arccos|arctan|cosh|sinh|tanh|cos|sin|tan/gi,function(e){return" \\"+e+" "})),n}var r=t.value,s=t,l=t.type;return l===i.LimitSymbol?(n+=TEX_TEXT[r]+" ",t.hasAnyBottom()&&(n+="_{"+e.getTex(t.region[u.BLEFT])+e.getTex(t.region[u.BELOW])+e.getTex(t.region[u.SUBSC])+"} "),t.hasAnyTop()&&(n+="^{"+e.getTex(t.region[u.TLEFT])+e.getTex(t.region[u.ABOVE])+e.getTex(t.region[u.SUPER])+"} ")):l===i.FRACTION?t.hasAnyTop()&&t.hasAnyBottom()?(n+=TEX_TEXT.fraction,n+="{",n+=e.getTex(t.region[u.TLEFT])+e.getTex(t.region[u.ABOVE])+e.getTex(t.region[u.SUPER]),n+="}{",n+=e.getTex(t.region[u.BLEFT])+e.getTex(t.region[u.BELOW])+e.getTex(t.region[u.SUBSC]),n+="} "):t.hasAnyBottom()?(n+=TEX_TEXT.overline,n+="{"+e.getTex(t.region[u.BLEFT])+e.getTex(t.region[u.BELOW])+e.getTex(t.region[u.SUBSC])+"}"):t.hasAnyTop()?(n+=TEX_TEXT.underline,n+="{"+e.getTex(t.region[u.TLEFT])+e.getTex(t.region[u.ABOVE])+e.getTex(t.region[u.SUPER])+"}"):n+=" - ":l===i.ROOT?(n+=TEX_TEXT[r]+"{"+e.getTex(t.region[u.CONTAINS])+"} ",t.region[u.SUPER].hasElement()&&(n+="^{"+e.getTex(t.region[u.SUPER])+"} "),t.region[u.SUBSC].hasElement()&&(n+="_{"+e.getTex(t.region[u.SUBSC])+"} ")):l===i.BRACKET?(n+=TEX_TEXT[r],s.bracketType==BRACKET_TYPES.CLOSE&&(t.region[u.SUPER].hasElement()&&(n+="^{"+e.getTex(t.region[u.SUPER])+"}"),t.region[u.SUBSC].hasElement()&&(n+="_{"+e.getTex(t.region[u.SUBSC])+"} "))):l==i.OPERATOR?n+=TEX_TEXT[r]:(n+=r,t.region[u.SUPER].hasElement()&&(n+="^{"+e.getTex(t.region[u.SUPER])+"}"),t.region[u.SUBSC].hasElement()&&(n+="_{"+e.getTex(t.region[u.SUBSC])+"}")),n}}]),e}();t.exports=f},{"./Expression":3,"./Symbol":9,"./SymbolFactory":10,"./constant":11,"./enums/BracketTypes":12,"./enums/RegionTypes":13,"./enums/SymbolTypes":14}],8:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.ROOT))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":14}],9:[function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();e("./enums/SymbolTypes");var r=e("./enums/RegionTypes"),i=function(){function e(t,n,o,i,s,l){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructor===e)throw new Error("Abstract Class Instatiation Error");this.type=l,this.minX=t,this.minY=n,this.maxX=t+o,this.maxY=n+i,this.value=s,this.width=o,this.height=i,this.x=(this.minX+this.maxX)/2,this.y=(this.minY+this.maxY)/2,this.region={};for(var a in r)this.region[r[a]]=new Expression(r[a]);this.wall={},this.size=o*i}return o(e,[{key:"hasAnyTop",value:function(){return this.region.tleft.hasElement()||this.region.above.hasElement()||this.region.supers.hasElement()}},{key:"hasAnyBottom",value:function(){return this.region.bleft.hasElement()||this.region.below.hasElement()||this.region.subsc.hasElement()}},{key:"setWall",value:function(e){this.wall.top=e.top,this.wall.bottom=e.bottom,this.wall.left=e.left,this.wall.right=e.right}},{key:"getWallCopy",value:function(){return{top:this.wall.top,bottom:this.wall.bottom,left:this.wall.left,right:this.wall.right}}},{key:"apply",value:function(e,t,n){for(var o in this.region)if(this.region[o].hasElement()){var r=t(this.region[o]);this.region[o].apply(e,t,function(e){return r&&n(e)})}}}]),e}();t.exports=i},{"./enums/RegionTypes":13,"./enums/SymbolTypes":14}],10:[function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();e("./Symbol");var r=e("./AlphanumericSymbol"),i=e("./BracketSymbol"),s=e("./FractionSymbol"),l=e("./LimitSymbol"),a=e("./OperatorSymbol"),u=e("./RootSymbol"),c=e("./RecognitionTool"),f=e("./enums/SymbolTypes"),y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"make",value:function(e){if(" "==e.textContent||"g"==e.tagName)return null;var t,n=svgedit.utilities.getBBox(e),o=n.x,y=n.y,p=n.width,m=n.height,h="path"==e.nodeName?e.id.split("_")[3]:e.textContent;switch(c.getSymbolType(h)){case f.BRACKET:t=new i(o,y,p,m,h);break;case f.FRACTION:sybmol=new s(o,y,p,m,h);break;case f.ROOT:t=new u(o,y,p,m,h);break;case f.LIMIT:t=new l(o,y,p,m,h);break;case f.ALPHANUMERIC:t=new r(o,y,p,m,h);break;case f.OPERATOR:t=new a(o,y,p,m,h);break;default:throw"Cannot have any other symbol than type."}return t}}]),e}();t.exports=y},{"./AlphanumericSymbol":1,"./BracketSymbol":2,"./FractionSymbol":4,"./LimitSymbol":5,"./OperatorSymbol":6,"./RecognitionTool":7,"./RootSymbol":8,"./Symbol":9,"./enums/SymbolTypes":14}],11:[function(e,t,n){"use strict";var o;function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=(r(o={sum:" \\sum ",lim:" \\lim ","∑":" \\sum ",fraction:" \\frac ",root:" \\sqrt ",integral:" \\int","∫":" \\int ",lbracket:" \\left( ",rbracket:" \\right) ","(":" \\left( ",")":" \\right) ","±":" \\pm ","∓":" \\mp ","+":" + ","×":" \\times ","—":" - ",overline:" \\overline ",underline:" \\underline ","<":" \\lt ","≤":" \\le ",">":" \\gt ","≥":" \\ge ","=":" = ","→":" \\to "},"lim"," \\lim "),r(o,"->","\\to "),o);t.exports={REGION_NAMES:{ROOT:"root",TLEFT:"tleft",ABOVE:"above",SUPERS:"supers",CONTAINS:"contains",BLEFT:"bleft",BELOW:"below",SUSC:"subsc"},SYMBOL_TYPES:{ALPHANUMERIC:"text",TEXT:"text",LIMIT:"limit",FRACTION:"fraction",BRACKET:"bracket",ROOT:"root",OPERATOR:"operator"},BRACKET_TYPES:{OPEN:"open",CLOSE:"close"},TEX_TEXT:i,BRAKET:["lbracket","(",")","rbracket"],LINE:["fraction","—"],LIMIT:["sum","∑","integral","∫","lim"],OPERATOR:["+","±","∓","<",">","≤","≥","=","×","→"]}},{}],12:[function(e,t,n){"use strict";t.exports={OPEN:0,CLOSE:1}},{}],13:[function(e,t,n){"use strict";t.exports={ROOT:0,TLEFT:1,ABOVE:2,SUPER:3,CONTAINS:4,BLEFT:5,BELOW:6,SUBSC:7}},{}],14:[function(e,t,n){"use strict";t.exports={ALPHANUMERIC:0,BRACKET:1,FRACTION:2,LIMIT:3,OPERATOR:4,ROOT:5}},{}],15:[function(e,t,n){"use strict";window.Tool={RecognitionTool:e("./RecognitionTool")}},{"./RecognitionTool":7}]},{},[15]);