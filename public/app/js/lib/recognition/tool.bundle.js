!function e(t,n,o){function r(s,l){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!l&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n||e)},c,c.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.ALPHANUMERIC))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":13}],2:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=e("./enums/BracketTypes"),s=function(e){function t(e,n,o,s,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,s,l,r.BRACKET));a.bracketType=i.CLOSE;var u=["lbracket","(",")","rbracket"];return u.indexOf(l)<u.length/2&&(a.minX-=o,a.maxX-=o,a.x-=o,a.bracketType=i.OPEN),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=s},{"./Symbol":9,"./enums/BracketTypes":11,"./enums/SymbolTypes":13}],3:[function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();e("./Symbol"),e("./enums/SymbolTypes");var r=e("./enums/RegionTypes"),i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.ROOT;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.region_type=t,this.region_name=t,this.wall={left:0,bottom:1/0,right:1/0,top:0},this.symbols=[]}return o(e,[{key:"addSymbol",value:function(e){this.symbols.push(e)}},{key:"setWall",value:function(e,t,n,o){if(!e.left)return e.length&&3==e.length?(this.wall.left=e[0][0],this.wall.bottom=e[0][1],this.wall.right=e[1][0],void(this.wall.top=e[1][1])):void(this.wall={left:e,bottom:o,right:n,top:t});this.wall=e}},{key:"hasElement",value:function(){return this.symbols.length>0}},{key:"apply",value:function(e,t,n){n||(n=function(){return!0}),t||(t=function(){return!0});for(var o=0;o<this.symbols.length;o++)if("lim"===this.symbols[o].value){for(var r=!1,i=0;i<this.symbols[o].subSymbols.length;i++)n(this.symbols[o].subSymbols[i])?(e(this.symbols[o].subSymbols[i]),this.symbols[o].subSymbols[i].apply(e,function(e){return!0},n),r=!0):this.symbols[o].subSymbols[i].apply(e,t,n);r?this.symbols[o].apply(e,function(e){return!0},n):this.symbols[o].apply(e,t,n)}else n(this.symbols[o])?(e(this.symbols[o]),this.symbols[o].apply(e,function(e){return!0},n)):this.symbols[o].apply(e,t,n)}}]),e}();t.exports=i},{"./Symbol":9,"./enums/RegionTypes":12,"./enums/SymbolTypes":13}],4:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.FRACTION))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":13}],5:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.LIMIT))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":13}],6:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.OPERATOR))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":13}],7:[function(e,t,n){"use strict";var o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var s,l=e[Symbol.iterator]();!(o=(s=l.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=e("./enums/SymbolTypes"),s=e("./SymbolFactory"),l=e("./enums/BracketTypes"),a=e("./Expression"),u=(e("./Symbol"),function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"hor",value:function(e,t){if(e[t].type===i.FRACTION||e[t].type===i.BRAKET&&e[t].bracketType==l.OPEN||e[t].type===i.OPERATOR){var n=e[t].getWallCopy();n.left=e[t].maxX;var o=this.start(e,n);return-1==o?-1:this.overlap(o,e[t].wall,e)}for(var r=0;r<e.length;){if(this.isInRegion(e[t].wall,e[r])&&!e[r].marked&&e[t].maxX<=e[r].minX&&e[t].minY+.4*e[t].height<=e[r].y&&e[r].y<e[t].maxY-1*e[t].height/5)return this.overlap(r,e[t].wall,e);r++}return-1}},{key:"overlap",value:function(e,t,n){var o,r=e,i=t.top,s=t.bottom,l=!1,a=n.length;o=(n[e].type,n[e].width);for(var u=-1;r>0&&!l;)n[r-1].maxX<n[e].minX?l=!0:r-=1;for(;r<a&&n[r].minX<n[e].maxX;)!n[r].marked&&"fraction"===n[r].type&&n[r].y>i&&n[r].y<=s&&n[r].minX<=n[e].x&&n[r].width>o?(o=n[r].width,u=r):r++;return-1==u?e:u}},{key:"isInRegion",value:function(e,t){return e.left<=t.x&&t.x<e.right&&e.top<=t.y&&t.y<=e.bottom}}],[{key:"getSymbolType",value:function(e){return-1!=BRACKET.indexOf(e)?i.BRACKET:-1!=LINE.indexOf(e)?i.FRACTION:-1!=ROOT.indexOf(e)?i.ROOT:-1!=LIMIT.indexOf(e)?i.LIMIT:-1!=OPERATOR.indexOf(e)?i.OPERATOR:i.ALPHANUMERIC}},{key:"start",value:function(e,t){for(var n=-1,o=-1,r=0,i=-1,s=e.length;-1==n&&r<s;)!e[r].marked&&this.isInRegion(t,e[r])?n=r:r+=1;if(-1==n||o==n)return n;for(;r<s&&-1==o;)!e[r].marked&&"limit"===e[r].type&&this.isInRegion(t,e[r])?o=r:r+=1;if(-1==o||o==n)return this.overlap(n,t,e);for(var l=e[o].maxY,a=e[o].minY;r>n;)e[r-=1].y<l&&e[r].y>=a&&(i=r);return i<o&&-1!=i?this.overlap(n,t,e):this.overlap(o,t,e)}},{key:"parse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t){t=[];var n=svgCanvas.getSelectedElems().slice(0);0==n.__proto__.length&&(n=document.querySelectorAll('[id^="svg_eqn_"]'));for(var r=0;r<n.length;r++){var i=s.make(n[r]);i&&t.push(i)}}t.sort(function(e,t){var n=e.minX-t.minX;return 0==n?e.minY-t.minY:n});var l,u,c,f,y,p=new a,h=[],b=[],m=p.wall,g=e.start(t,m);for(-1!=g&&(t[g].setWall(m),b.push([g,p]),t[g].marked=!0);0!=b.length;)for(;0!=b.length;){var T=b.shift(),v=o(T,2);for(l=v[0],c=v[1],(f=t[l]).marked=!0,c.symbols.push(f),h.push([l,f]),m=t[l].wall,u=this.hor(t,l);-1!=u;){var w=t[l].wall;t[u].setWall(w),f=t[u];var O=c.symbols.length;if("m"===f.value&&O>=2&&"i"===c.symbols[O-1].value&&"l"===c.symbols[O-2].value){var E=c.symbols[O-1],x=c.symbols[O-2],S=x.minX,_=x.minY,d=f.x+f.width-S,R=x.height,k=new LimitSymbol(S,_,d,R,"lim");k.setWall(w),k.subSymbols=[x,E,f],f=k,t[u]=f,h.splice(h.indexOf([t.indexOf(x),x]),1),h.splice(h.indexOf([t.indexOf(E),E]),1),c.symbols.pop(),c.symbols.pop()}c.symbols.push(f),h.push([u,f]),t[l].wall.right=t[u].minX,"limit"!==t[u].type||"bracket"!==t[l].type&&"line"!==t[l].type||(t[u].wall.left=t[l].maxX),t[l=u].marked=!0,u=this.hor(t,l)}for(h.push("EOBL");0!=h.length;){"EOBL"===h[h.length-1]&&h.pop();var A=h.pop(),C=o(A,2);l=C[0];var P=(f=C[1]).wall.top,X=f.wall.bottom,j=c.symbols.indexOf(f),I=j==c.symbols.length-1?f.wall.right:c.symbols[j+1].minX,B=f.minX;f.type===SYMBOL_TYPES.LIMIT&&(0==j?B=m.left:c.symbols[j-1].type===SYMBOL_TYPES.BRACKET?B=c.symbols[j-1].maxX:c.symbols[j-1].type===SYMBOL_TYPES.FRACTION&&(B=c.symbols[j-1].maxX));for(var L=f.minX,N=f.maxX,Y=f.minY,M=f.maxY,F=Y+.4*(M-Y),W=M-.4*(M-Y),K=[[[L,Y],[N,P],"above"],[[L,X],[N,M],"below"],[[N,F],[I,P],"supers"],[[N,X],[I,W],"subsc"],[[B,F],[L,P],"tleft"],[[B,X],[L,W],"bleft"],[[L,M],[N,Y],"contains"]],U=0;U<K.length;U++)f.region[K[U][2]]&&(f.region[K[U][2]].setWall(K[U]),-1!=(u=this.start(t,f.region[K[U][2]].wall))&&(t[u].marked=!0,t[u].setWall(f.region[K[U][2]].wall),y=f.region[K[U][2]],b.push([u,y])))}}return p}},{key:"getTex",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.parse(),n="";if(t.symbols){"root"==t.region_name&&(n+="$$");for(var o=0;o<t.symbols.length;o++){n+=e.getTex(t.symbols[o])}return n.indexOf("lim")>=0&&(n=n.replace("li "," ")),"root"==t.region_name&&(n=(n+="$$").replace(/arcsin|arccos|arctan|cosh|sinh|tanh|cos|sin|tan/gi,function(e){return" \\"+e+" "})),n}var r=t.value,i=t,s=t.type;return"limit"===s?(n+=TEX_TEXT[r]+" ",t.hasAnyBottom()&&(n+="_{"+e.getTex(t.region.bleft)+e.getTex(t.region.below)+e.getTex(t.region.subsc)+"} "),t.hasAnyTop()&&(n+="^{"+e.getTex(t.region.tleft)+e.getTex(t.region.above)+e.getTex(t.region.supers)+"} ")):"fraction"===s?t.hasAnyTop()&&t.hasAnyBottom()?(n+=TEX_TEXT.fraction,n+="{",n+=e.getTex(t.region.tleft)+e.getTex(t.region.above)+e.getTex(t.region.supers),n+="}{",n+=e.getTex(t.region.bleft)+e.getTex(t.region.below)+e.getTex(t.region.subsc),n+="} "):t.hasAnyBottom()?(n+=TEX_TEXT.overline,n+="{"+e.getTex(t.region.bleft)+e.getTex(t.region.below)+e.getTex(t.region.subsc)+"}"):t.hasAnyTop()?(n+=TEX_TEXT.underline,n+="{"+e.getTex(t.region.tleft)+e.getTex(t.region.above)+e.getTex(t.region.supers)+"}"):n+=" - ":"root"===s?(n+=TEX_TEXT[r]+"{"+e.getTex(t.region.contains)+"} ",t.region.supers.hasElement()&&(n+="^{"+e.getTex(t.region.supers)+"} "),t.region.subsc.hasElement()&&(n+="_{"+e.getTex(t.region.subsc)+"} ")):"bracket"===s?(n+=TEX_TEXT[r],i.bracketType==BRACKET_TYPES.CLOSE&&(t.region.supers.hasElement()&&(n+="^{"+e.getTex(t.region.supers)+"}"),t.region.subsc.hasElement()&&(n+="_{"+e.getTex(t.region.subsc)+"} "))):"operator"==s?n+=TEX_TEXT[r]:(n+=r,t.region.supers.hasElement()&&(n+="^{"+e.getTex(t.region.supers)+"}"),t.region.subsc.hasElement()&&(n+="_{"+e.getTex(t.region.subsc)+"}")),n}}]),e}());t.exports=u},{"./Expression":3,"./Symbol":9,"./SymbolFactory":10,"./enums/BracketTypes":11,"./enums/SymbolTypes":13}],8:[function(e,t,n){"use strict";var o=e("./Symbol"),r=e("./enums/SymbolTypes"),i=function(e){function t(e,n,o,i,s){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,i,s,r.ROOT))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),t}();t.exports=i},{"./Symbol":9,"./enums/SymbolTypes":13}],9:[function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();e("./enums/SymbolTypes");var r=e("./enums/RegionTypes"),i=function(){function e(t,n,o,i,s,l){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructor===e)throw new Error("Abstract Class Instatiation Error");this.type=l,this.minX=t,this.minY=n,this.maxX=t+o,this.maxY=n+i,this.value=s,this.width=o,this.height=i,this.x=(this.minX+this.maxX)/2,this.y=(this.minY+this.maxY)/2,this.region={};for(var a in r)this.region[r[a]]=new Expression(r[a]);this.wall={},this.size=o*i}return o(e,[{key:"hasAnyTop",value:function(){return this.region.tleft.hasElement()||this.region.above.hasElement()||this.region.supers.hasElement()}},{key:"hasAnyBottom",value:function(){return this.region.bleft.hasElement()||this.region.below.hasElement()||this.region.subsc.hasElement()}},{key:"setWall",value:function(e){this.wall.top=e.top,this.wall.bottom=e.bottom,this.wall.left=e.left,this.wall.right=e.right}},{key:"getWallCopy",value:function(){return{top:this.wall.top,bottom:this.wall.bottom,left:this.wall.left,right:this.wall.right}}},{key:"apply",value:function(e,t,n){for(var o in this.region)if(this.region[o].hasElement()){var r=t(this.region[o]);this.region[o].apply(e,t,function(e){return r&&n(e)})}}}]),e}();t.exports=i},{"./enums/RegionTypes":12,"./enums/SymbolTypes":13}],10:[function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();e("./Symbol");var r=e("./AlphanumericSymbol"),i=e("./BracketSymbol"),s=e("./FractionSymbol"),l=e("./LimitSymbol"),a=e("./OperatorSymbol"),u=e("./RootSymbol"),c=e("./RecognitionTool"),f=e("./enums/SymbolTypes"),y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"make",value:function(e){if(" "==e.textContent||"g"==e.tagName)return null;var t,n=svgedit.utilities.getBBox(e),o=n.x,y=n.y,p=n.width,h=n.height,b="path"==e.nodeName?e.id.split("_")[3]:e.textContent;switch(c.getSymbolType(b)){case f.BRACKET:t=new i(o,y,p,h,b);break;case f.FRACTION:sybmol=new s(o,y,p,h,b);break;case f.ROOT:t=new u(o,y,p,h,b);break;case f.LIMIT:t=new l(o,y,p,h,b);break;case f.ALPHANUMERIC:t=new r(o,y,p,h,b);break;case f.OPERATOR:t=new a(o,y,p,h,b);break;default:throw"Cannot have any other symbol than type."}return t}}]),e}();t.exports=y},{"./AlphanumericSymbol":1,"./BracketSymbol":2,"./FractionSymbol":4,"./LimitSymbol":5,"./OperatorSymbol":6,"./RecognitionTool":7,"./RootSymbol":8,"./Symbol":9,"./enums/SymbolTypes":13}],11:[function(e,t,n){"use strict";t.exports={OPEN:0,CLOSE:1}},{}],12:[function(e,t,n){"use strict";t.exports={ROOT:0,TLEFT:1,ABOVE:2,SUPER:3,CONTAINS:4,BLEFT:5,BELOW:6,SUBSC:7}},{}],13:[function(e,t,n){"use strict";t.exports={ALPHANUMERIC:0,BRACKET:1,FRACTION:2,LIMIT:3,OPERATOR:4,ROOT:5}},{}],14:[function(e,t,n){"use strict";window.Tool={RecognitionTool:e("./RecognitionTool")}},{"./RecognitionTool":7}]},{},[14]);